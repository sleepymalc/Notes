\lecture{24}{06 Dec. 12:30}{Matching Market}
\section{Bayesian Nash Equilibrium}
\begin{prev}
	For a valuation \(\vec{v}\), the bid \(\sigma^{\ast}(\vec{v})\) is in the same space as \(\vec{v}\) by \hyperref[thm:revelation-principle]{revelation principle}. With allocation being specified as
	\[
		\vec{x}_{i}(v_{i})
	\]
	which is monotonically increasing, and the payment being specified as
	\[
		\overline{p}_{i}(v_{i}) = v_{i}\overline{x}_{i}(v_{i}) - \int_0^{v_{i}}\overline{x}_{i}(z)\,\mathrm{d}z + \overline{p}_{i}(0),
	\]
	then we can analyze a general auction with \autoref{thm:Bayesian-Nash-equilibrium-characterization}.
\end{prev}

\subsection{Revenue Equivalence}
We start with the expected revenue. The expected revenue is
\[
	\mathbb{E}_{v}\left[\sum\limits_{i}\overline{p}_{i}(v_{i}) \right] = \mathbb{E}_{v}\left[F(\vec{v})\right] + \sum\limits_{i=1}^{I} \overline{p}_{i}(v).
\]
\begin{enumerate}[(a)]
	\item If two mechanisms have the same allocation rule in \hyperref[def:Nash-equilibrium]{equilibrium}, then
	      \begin{itemize}
		      \item \(\overline{x}_{i}(v_{i})\) will be the same
		      \item \(\overline{p}_{i}(v_{i})\) will be the same except for the \(\overline{p}_{i}(0)\) term.
	      \end{itemize}
	\item If \hyperref[def:player]{agent} with valuation zero, pay zero, then
	      \[
		      \overline{p}_{i}(0) = 0
	      \]
	      in both mechanisms. This implies that the revenue will be the same.
\end{enumerate}

\begin{note}
	Similar characterization holds for \hyperref[def:dominant-strategy]{dominant strategy} \hyperref[def:Nash-equilibrium]{equilibrium} but those \hyperref[def:ex-post]{ex-post}.
	\begin{itemize}
		\item Allocation rule property.
		\item Payment rule property.
	\end{itemize}
\end{note}

If we now assume \hyperref[def:independent]{independence} and identical valuation setting, together with the valuation being \(\mathrm{uniform}([0,1])\). Then the \hyperref[eg:second-price-auction]{second-price auction} and \hyperref[eg:first-price-auction]{first-price auction} are \hyperref[rmk:revenue-equivalence]{revenue equivalent}.

By symmetry, the payment rules will be identical in each auction, hence the revenue is
\[
	I\times \text{payment rule for each agent}.
\]

\begin{itemize}
	\item For the \hyperref[eg:second-price-auction]{second price auction} (SP),
	      \[
		      \overline{p}_1^{\mathrm{SP}}(v_1) = \mathbb{E}\left[\left(\max_{j\in -1}v_{j}\right)\mathbbm{1}_{\{ \max\limits_{j\in -1} v_{j}\leq v_1\}}  \right] .
	      \]
	      Denote \(\widetilde{p}_1 = \max\limits_{j\in -1} v_{j}\), then
	      \[
		      F_{\widetilde{p}^{\mathrm{SP}}_i}(x) = \Pr(\widetilde{p}_1\leq x) = \Pr(v_2\leq x, v_3\leq x, \ldots , v_I\leq x) = x^{I-1},
	      \]
	      where \(x\in [0, 1]\). Then,
	      \[
		      f_{\widetilde{p}^{\mathrm{SP}}}(x) = (I - 1)x^{I-2}.
	      \]
	      We see that
	      \[
		      \begin{split}
			      \widetilde{p}_1^{\mathrm{SP}} &= \mathbb{E}\left[\widetilde{p}_{1}\mathbbm{1}_{\{ \widetilde{p}_1\leq v_1 \}} \right]
			      =\int_0^{v_1} xf_{\widetilde{p}_1}(x)\,\mathrm{d}x\\
			      &= (I - 1)\int_0^{v_1}x\cdot x^{I-2}\,\mathrm{d}x
			      = (I - 1)\int_0^{v_1}x^{I-1}\,\mathrm{d}x
			      = \frac{I-1}{I}v_1^I.
		      \end{split}
	      \]
	\item For the \hyperref[eg:first-price-auction]{first price auction} (FP),
	      \[
		      \overline{p}_1^{\mathrm{FP}}(v_1)
		      = \sigma^{\mathrm{FP}}(v_1)\Pr(\text{\hyperref[def:player]{Agent} 1 has the highest value \(v_1\)})
		      = \sigma^{\mathrm{FP}}(v_1)v_1^{I-1},
	      \]
	      where every other \hyperref[def:player]{agent}'s value is less or equal to \(v_1\).

	      From \hyperref[rmk:revenue-equivalence]{revenue equivalence},
	      \[
		      \widetilde{p}^{\mathrm{SP}}(v_1) = \widetilde{p}^{\mathrm{FP}}(v_1),
	      \]
	      which implies
	      \[
		      \frac{I-1}{I}v_{1}^I = \sigma^{\mathrm{FP}}(v_1)v_1^{I-1} \implies \sigma^{\mathrm{FP}} = \frac{I-1}{I}v_1,
	      \]
	      as we discussed before.
\end{itemize}

\chapter{Matching Market}
Beyond the current setup of \hyperref[ch:auctions]{auctions}, we can see a more general setup. Specifically, we introduce so-called
\textbf{Matching Market}.

\begin{note}
	The comparison between auctions and matching market is as follows.
	\begin{itemize}
		\item One good to many buyers: Auctions.
		\item Many goods to many buyers: Matching Market.
	\end{itemize}
\end{note}

\section{Ads Auctions}
We first see an example of matching market in terms of a general form of auction, namely \emph{ad-auctions}. Specifically, consider a particular keyword searching result, the ads related to which may show up in the following order:
\begin{itemize}
	\item AD1 with \(r_1\)
	\item AD2 with \(r_2\)
	\item AD3 with \(r_3\)
	\item AD4 with \(r_4\)
	\item \(\vdots\)
\end{itemize}
where \(r_i\) is so-called the \href{https://en.wikipedia.org/wiki/Click-through_rate}{\underline{click-through rate}} for ad location \(i\). We see that the location of ads matter.

\begin{note}
	We see that
	\begin{itemize}
		\item \href{https://en.wikipedia.org/wiki/Click-through_rate}{Click-through rate} is location dependent. Person needs to click on ad and then buy the product the ad is about.
		\item Often, \(r_i < r_j\) for \(i > j\). (i.e., people prefer to click on ads on the top)
	\end{itemize}
\end{note}

We see that there is a \href{https://en.wikipedia.org/wiki/Bipartite_graph}{\underline{bipartite structure}}. On the one side of the \hyperref[def:graph]{graph} contains buyers, and the other side contains sellers (Ad positions). Now, assuming for each buyer's good \(i\), the cost is \(b_i\). Then the expected revenue to advertiser \(i\) is
\[
	b_i r_j
\]
if one purchase the location \(j\). Now, let \(v_{ij} \coloneqq b_{i}r_{i}\), where \(i\) denotes the buyers, and \(j\) denotes the sellers. Then we have the so-called \hyperref[def:valuation-matrix]{valuation matrix} \(V\) defined as follows.

\begin{definition}[Valuation matrix]\label{def:valuation-matrix}
	The \emph{valuation matrix} \(V\) is matrix with element \(V_{ij}\) being the amount that bidder \(i\) values good \(j\).
\end{definition}

We see that in our case, i.e., ads-auctions, our \hyperref[def:valuation-matrix]{valuation matrix} can be defined as
\[
	V \coloneqq \vec{r} ^{\top} \vec{b}.
\]
If \(V_{ij}\geq 0\) and beyond rank-one imply good allocation here. Note that we allow the sellers to set prices to goods.
\begin{remark}
	There are different types of prices.
	\begin{itemize}
		\item \label{rmk:posted} Posted. Item comes with price.
		\item \label{rmk:anonymous} Anonymous. The price is the same for any buyers.
	\end{itemize}
\end{remark}

\begin{definition}[Balance]\label{def:balance}
	The market is called \emph{balance} if the number of sellers and buyers are the same.
\end{definition}

Without loss of generality, we assume that the market is \hyperref[def:balance]{balanced} by letting
\[
	V\in \mathbb{\MakeUppercase{R}}^{N\times N},
\]
which implies there are a same number (\(N\)) of buyers and sellers.

\begin{remark}[Balance the market]
	This can be achieved by adding \underline{dummy} buyers or sellers.
	\begin{itemize}
		\item Dummy buyers: Value every good as \(0\).
		\item Dummy sellers: Valued as \(0\) for every buyer.
	\end{itemize}
\end{remark}

Consider each seller/item coming with a \hyperref[rmk:posted]{posted} and \hyperref[rmk:anonymous]{anonymous} price, namely item \(j\) has price \(p_j\geq 0\).
\begin{problem}
How does a buyer \(i\) react to this? Assuming \(i\) knows his valuation, and each buyer can only purchase one good.
\end{problem}
\begin{answer}
	Suppose the valuation for buyer \(i\) is \(V_{i1}, V_{i2}, \ldots , V_{iN},\) and the prices for each good is \(p_{1}, p_2, \ldots , p_{N}\). Then it's clear that buyer \(i\) will
	\begin{enumerate}[(a)]
		\item only consider item whose valuation exceeds the price,
		\item focus only on goods whose \hyperref[def:reward]{payoff} is maximum (\(\text{valuation}-\text{price}\)).
	\end{enumerate}

	Mathematically, we have
	\[
		\underset{j\colon V_{ij}\geq p_{j}}{\arg\max} V_{ij} - p_{j}.
	\]

	For convenience, we define a function \(\left[\ \cdot\ \right]_+\) such that
	\[
		\left[ x \right]_+ \coloneqq \max(x, 0) = \begin{dcases}
			x, & \text{ if } x\geq 0; \\
			0, & \text{ if } x\leq 0. \\
		\end{dcases}
	\]
	Then the \hyperref[def:reward]{utility} of buyer \(i\) at price vector \(\vec{p}\) is
	\[
		u_{i} = \left[\max_{j\in\{1, \ldots , N\}} V_{ij} - p_{j}\right]_+ = \max_{j\in \{1, \ldots , N\}}\left[V_{ij}-p_{j}\right]_+.
	\]

	We then defined so-called \hyperref[def:preferred-sellers-list]{preferred sellers list} \(s(i)\) for buyer \(i\) as follows.

	\begin{definition}[Preferred sellers list]\label{def:preferred-sellers-list}
		The \emph{preferred sellers list}, denotes as \(s(i)\) for buyer \(i\), is defined as
		\[
			s(i) \coloneqq  \begin{dcases}
				\varnothing ,                           & \text{ if }  \forall j\ V_{ij}<p_{j}; \\
				\arg\max_j \left(V_{ij} - p_{j}\right), & \text{ otherwise}.
			\end{dcases}
		\]
	\end{definition}
	Note that \(s(i)\) contains goods that buyer \(i\) is interested in.

	\begin{remark}
		If \(s(i)\neq \varnothing \), then there is at last one seller that buyer \(i\) is interested in.
	\end{remark}

	We then use the \hyperref[def:preferred-sellers-list]{preferred sellers lists} to construct an \hyperref[def:undirected-graph]{undirected} \href{https://en.wikipedia.org/wiki/Bipartite_graph}{bipartite graph} between buyers and sellers.
\end{answer}

\begin{eg}
	Let \(N = 3\), and
	\[
		V\coloneqq \begin{pmatrix}
			5 & 3 & 4 \\
			3 & 8 & 3 \\
			5 & 4 & 7 \\
		\end{pmatrix}, \quad p \coloneqq \begin{pmatrix}
			4 \\
			3 \\
			7 \\
		\end{pmatrix},
	\]
	the goal is to fulfill the market as much as possible.
\end{eg}
\begin{explanation}
	Then, we have
	\begin{enumerate}
		\item Buyer 1. \(V_{11}-p_1 = 1\), \(V_{12} - p_2 = 0\), \(V_{13} - p_3 = -3\). Hence,
		      \[
			      s(1) = \left\{1\right\}.
		      \]
		\item Buyer 2. \(V_{21}-p_1 = -1\), \(V_{22} - p_2 = 5\), \(V_{23} - p_3 = -4\). Hence,
		      \[
			      s(2) = \left\{2\right\}.
		      \]
		\item Buyer 3. \(V_{31}-p_1 = 1\), \(V_{32} - p_2 = 1\), \(V_{33} - p_3 = 0\). Hence,
		      \[
			      s(3) = \left\{1, 2\right\}.
		      \]
	\end{enumerate}
	We see that \(c\) is not desired by any buyers at current price.
	\begin{center}
		\incfig{satisfaction-eg-1}
	\end{center}
\end{explanation}

\begin{eg}
	Consider the same \hyperref[def:valuation-matrix]{valuation matrix} \(V\) as above while change \(p\) into
	\[
		p = \begin{pmatrix}
			0 \\
			0 \\
			0 \\
		\end{pmatrix}.
	\]
\end{eg}
\begin{explanation}
	Then we see that satisfaction is possible.
	\begin{center}
		\incfig{satisfaction-eg-2}
	\end{center}
\end{explanation}

\begin{eg}
	Consider the same \hyperref[def:valuation-matrix]{valuation matrix} \(V\) as above while change \(p\) into
	\[
		p = \begin{pmatrix}
			5 \\
			8 \\
			7 \\
		\end{pmatrix}.
	\]
\end{eg}
\begin{explanation}
	Then we see that satisfaction is possible as well.
	\begin{center}
		\incfig{satisfaction-eg-3}
	\end{center}
\end{explanation}

\begin{remark}
	We see that the satisfaction match is not always possible.
\end{remark}

\section{Perfect Matching}
We now discuss a general matching problem.

\begin{remark}
	Note that the discussion about ad-auctions is indeed general enough to be considered as a general market matching problem since if we neglect the meaning of \(V\) under the content of ads-auctions, instead just interpret \(V_{ij} \) as in the original \hyperref[def:valuation-matrix]{definition}, then it's just a general matching problem.
\end{remark}

The task is that for any given price and the \hyperref[def:valuation-matrix]{valuation matrix} \(V\), find the \hyperref[def:preferred-sellers-list]{preferred sellers} \href{https://en.wikipedia.org/wiki/Bipartite_graph}{bipartite graph} and perform matching. Furthermore, we try to maximize the matching in terms of size. In other words, we are trying to satisfy as many buyers as possible. This suggests the following definition.
\begin{definition}[Perfect matching]\label{def:perfect-matching}
	We call a matching is a \emph{perfect matching} if the size of the maximum matching is \(N\).
\end{definition}

To discuss \hyperref[def:perfect-matching]{perfect matching}, we first defined some notations. Let
\[
	S\subseteq \{1, \ldots , N\}
\]
be the subset of sellers, and
\[
	B\subseteq\{1, \ldots , N\}
\]
be the subset of buyers. We further denote \(N(S)\) be the union of all buyers that like goods in \(S\), and \(N(B)\) be the union of \hyperref[def:preferred-sellers-list]{preferred sellers} of all the buyers in \(B\).

\begin{definition}[Constricted set]\label{def:constricted-set}
	Given the definition of \(N(S)\), we say \(S\) is a \emph{constricted set} if \(\left\vert S \right\vert > \left\vert N(S) \right\vert \).
\end{definition}

\begin{note}
	Similarly, if \(\left\vert B \right\vert > \left\vert N(B) \right\vert \) then \(B\) is \hyperref[def:constricted-set]{constricted}.
\end{note}


\begin{theorem}[KÅ‘nig-Hall maximize theorem]\label{thm:Konig-Hall-maximize-theorem}
	A \href{https://en.wikipedia.org/wiki/Bipartite_graph}{bipartite graph} has a \hyperref[def:perfect-matching]{perfect matching} if and only if there are no \hyperref[def:constricted-set]{constricted sets}.
\end{theorem}
\begin{note}
	This is a necessary and sufficient conditions for a \hyperref[def:perfect-matching]{perfect matching} to exist given a \href{https://en.wikipedia.org/wiki/Bipartite_graph}{bipartite graph}.
\end{note}

\begin{remark}
	With naive approach, we need to check every non-empty subset of sellers. Hence, there are \(2^N - 1\) checks, but polynomial time checks exists. Hence, We can also find a \hyperref[def:perfect-matching]{perfect matching} in polynomial time.

	\begin{note}[Market clearing prices]\label{note:market-clearing-prices}
		The prices for which a \hyperref[def:perfect-matching]{perfect matching} exists are called \emph{market clearing prices}.
	\end{note}
\end{remark}